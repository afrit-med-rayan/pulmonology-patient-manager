<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quick Integration Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }

      .header {
        background: linear-gradient(135deg, #2c5aa0, #4a7bc8);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
      }

      .test-result {
        background: white;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        border-left: 4px solid #ccc;
      }

      .test-result.passed {
        border-left-color: #28a745;
      }

      .test-result.failed {
        border-left-color: #dc3545;
      }

      .test-name {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .test-details {
        font-size: 14px;
        color: #666;
      }

      .summary {
        background: white;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        text-align: center;
      }

      .btn {
        background: #2c5aa0;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 10px;
      }

      .btn:hover {
        background: #1e3f73;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>üß™ Quick Integration Test</h1>
      <p>Testing Patient Management System Integration</p>
    </div>

    <div>
      <button class="btn" onclick="runQuickTest()">Run Quick Test</button>
      <button class="btn" onclick="openMainApp()">Open Main App</button>
      <button class="btn" onclick="clearResults()">Clear Results</button>
    </div>

    <div id="results"></div>

    <div class="summary" id="summary" style="display: none">
      <h3>Test Summary</h3>
      <div id="summaryContent"></div>
    </div>

    <script>
      async function runQuickTest() {
        const resultsDiv = document.getElementById("results");
        const summaryDiv = document.getElementById("summary");
        const summaryContent = document.getElementById("summaryContent");

        resultsDiv.innerHTML = "<p>Running tests...</p>";
        summaryDiv.style.display = "none";

        const tests = [
          {
            name: "Check if files exist",
            test: async () => {
              const files = [
                "js/app.js",
                "js/components/PatientManager.js",
                "js/components/DataStorageManager.js",
                "css/base.css",
              ];

              for (const file of files) {
                try {
                  const response = await fetch(file);
                  if (!response.ok) {
                    return { success: false, error: `File ${file} not found` };
                  }
                } catch (error) {
                  return { success: false, error: `Cannot access ${file}` };
                }
              }

              return {
                success: true,
                details: "All required files are accessible",
              };
            },
          },
          {
            name: "Check localStorage availability",
            test: async () => {
              try {
                localStorage.setItem("test", "value");
                const value = localStorage.getItem("test");
                localStorage.removeItem("test");

                if (value !== "value") {
                  return {
                    success: false,
                    error: "localStorage not working correctly",
                  };
                }

                return { success: true, details: "localStorage is working" };
              } catch (error) {
                return { success: false, error: "localStorage not available" };
              }
            },
          },
          {
            name: "Check browser compatibility",
            test: async () => {
              const features = {
                "ES6 Classes": typeof class {} === "function",
                "Async/Await": typeof (async () => {}) === "function",
                "Fetch API": typeof fetch === "function",
                localStorage: typeof localStorage === "object",
                sessionStorage: typeof sessionStorage === "object",
                JSON: typeof JSON === "object",
              };

              const missing = Object.entries(features)
                .filter(([name, available]) => !available)
                .map(([name]) => name);

              if (missing.length > 0) {
                return {
                  success: false,
                  error: `Missing features: ${missing.join(", ")}`,
                };
              }

              return {
                success: true,
                details: "All required browser features available",
              };
            },
          },
          {
            name: "Check CSS loading",
            test: async () => {
              const stylesheets = document.querySelectorAll(
                'link[rel="stylesheet"]'
              );

              if (stylesheets.length === 0) {
                return { success: false, error: "No CSS files loaded" };
              }

              // Check if at least one stylesheet loaded successfully
              for (const stylesheet of stylesheets) {
                if (stylesheet.sheet && stylesheet.sheet.cssRules) {
                  return {
                    success: true,
                    details: `${stylesheets.length} CSS files loaded`,
                  };
                }
              }

              return { success: false, error: "CSS files failed to load" };
            },
          },
          {
            name: "Check HTML structure",
            test: async () => {
              const requiredElements = [
                "app",
                "main-content",
                "toast-container",
                "modal-container",
              ];

              const missing = requiredElements.filter(
                (id) => !document.getElementById(id)
              );

              if (missing.length > 0) {
                return {
                  success: false,
                  error: `Missing elements: ${missing.join(", ")}`,
                };
              }

              return {
                success: true,
                details: "All required HTML elements present",
              };
            },
          },
        ];

        const results = [];
        resultsDiv.innerHTML = "";

        for (const test of tests) {
          const resultDiv = document.createElement("div");
          resultDiv.className = "test-result";

          try {
            const result = await test.test();

            resultDiv.classList.add(result.success ? "passed" : "failed");
            resultDiv.innerHTML = `
                        <div class="test-name">${
                          result.success ? "‚úÖ" : "‚ùå"
                        } ${test.name}</div>
                        <div class="test-details">${
                          result.details || result.error || "No details"
                        }</div>
                    `;

            results.push({
              name: test.name,
              success: result.success,
              error: result.error,
              details: result.details,
            });
          } catch (error) {
            resultDiv.classList.add("failed");
            resultDiv.innerHTML = `
                        <div class="test-name">üí• ${test.name}</div>
                        <div class="test-details">Error: ${error.message}</div>
                    `;

            results.push({
              name: test.name,
              success: false,
              error: error.message,
            });
          }

          resultsDiv.appendChild(resultDiv);
        }

        // Show summary
        const passed = results.filter((r) => r.success).length;
        const total = results.length;
        const successRate = Math.round((passed / total) * 100);

        summaryContent.innerHTML = `
                <p><strong>Total Tests:</strong> ${total}</p>
                <p><strong>Passed:</strong> ${passed}</p>
                <p><strong>Failed:</strong> ${total - passed}</p>
                <p><strong>Success Rate:</strong> ${successRate}%</p>
                ${
                  successRate === 100
                    ? '<p style="color: #28a745;">üéâ All tests passed! The application should work correctly.</p>'
                    : '<p style="color: #dc3545;">‚ö†Ô∏è Some tests failed. Please check the issues above.</p>'
                }
            `;

        summaryDiv.style.display = "block";
      }

      function openMainApp() {
        window.open("index.html", "_blank");
      }

      function clearResults() {
        document.getElementById("results").innerHTML = "";
        document.getElementById("summary").style.display = "none";
      }

      // Auto-run test on page load
      window.addEventListener("load", () => {
        setTimeout(runQuickTest, 500);
      });
    </script>
  </body>
</html>
